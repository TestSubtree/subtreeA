name: PR Workflow for main

on:
  pull_request:
    branches:
      - main # PR 대상 브랜치가 main일 때만 트리거

jobs:
  check_subtree_changes:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository A
      - name: Checkout repository A
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Clone repository B
      - name: Clone repository B
        run: |
          git clone --branch main --depth 1 https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/TestSubtree/subtreeC.git repository_database

      # 3. Compare subtree changes
      - name: Check subtree changes
        id: check_changes
        run: |
          if diff -qr --exclude=".git" C repository_database; then
            echo "No changes in subtree."
            echo "no_changes=true" >> $GITHUB_ENV
          else
            echo "Subtree has changes."
            echo "no_changes=false" >> $GITHUB_ENV
            exit 0
          fi

      # 4. Print message and exit if no changes
      - name: No changes in subtree
        if: env.no_changes == 'true'
        run: echo "수정사항이 없습니다. 워크플로우를 종료합니다."

      # 5. Print message if changes exist
      - name: Subtree has changes
        if: env.no_changes == 'false'
        run: echo "수정사항이 있습니다. 후속 작업을 진행합니다."
